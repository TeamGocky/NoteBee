{% extends "base.html" %}
{% block title %}CodeBuzz - {{ snippet.name.capitalize }} by
    {% if snippet.user %}
        {{ snippet.user }}
    {% else %}
        Anonymous
    {% endif %}
{% endblock %}
{% block head_includes %}
    {% load staticfiles %}
    <script src="{% static "js/lib/codemirror.js" %}"></script>
    <script src="{% static "js"%}/mode/codemirror-compressed.js"></script>
{% endblock %}
{% block body %}
    {% if errors %}
        <h5>Errors:</h5>
        <ul>
            {% for err in errors %}
                <li class="error">{{ err }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if snippet %}
		<h3>{{ snippet.name.capitalize }} by
		{% if snippet.user %}
			<a href="/accounts/view/{{ snippet.user.id }}">{{ snippet.user }}</a>
		{% else %}
			Anonymous
		{% endif %}
		</h3>
        {% for name, value in snippet.attrs %}
            <p>
                <label for="{{ name }}">{{ name.capitalize }}:</label>
                {% if name == "body" %}
                    <textarea id="editor">{{ snippet.body }}</textarea>
                {% elif name == "user" and not value %}
                    Anonymous
                {% elif name == "user" %}
                    <a href="/accounts/view/{{ snippet.user.id }}">{{ value }}</a>
                {% else %}
                    {{ value }}
                {% endif %}
            </p>
        {% endfor %}
	    <p>
            <label for="rating">Rating:</label>{{ rating }}
            <form id="rating_form" method="post"
                  action="/codesnippet/rating/{{ snippet.id }}/">
                {% csrf_token %}
                {{ rating_form.rating }}
            </form>
        </p>
        <script>
            var editor = document.getElementById("editor");
            var langOpts = document.getElementById("languages");
            var myCodeMirror = CodeMirror.fromTextArea(editor, {
                autofocus: true,
                indentUnit: 4,
                lineNumbers: true,
                lineWrapping: true,
                mode: "{{ snippet.language.mode }}",
				readOnly: true,
            });
            
            // on change event for the rating posting
            function submitRating() {
                document.getElementById("rating_form").submit();
            }
        </script>
    {% endif %}
{% endblock %}
